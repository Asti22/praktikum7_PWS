<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Generate API Key â€” Form</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#9aa4b2;
      --accent:#6ee7b7;
      --glass: rgba(255,255,255,0.04);
      --radius:12px;
      font-family: Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0;min-height:100vh;background:linear-gradient(180deg,#071026 0%, #08111b 60%);
      color:#e6eef6;display:flex;align-items:center;justify-content:center;padding:24px;
    }
    .wrap{width:100%;max-width:920px}
    .card{
      background:linear-gradient(180deg,rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius);padding:22px;
      box-shadow:0 8px 30px rgba(2,6,23,0.6);backdrop-filter:blur(6px);
    }
    .header{display:flex;gap:16px;align-items:center;justify-content:space-between}
    h1{margin:0;font-size:18px;letter-spacing:0.2px}
    p.lead{margin:2px 0 0;color:var(--muted);font-size:13px}

    form{
      margin-top:18px;display:grid;grid-template-columns:1fr 320px;gap:18px;
    }

    .controls{display:flex;flex-direction:column;gap:12px}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}

    .input, .select, .textarea{
      width:100%;padding:12px 14px;border-radius:10px;
      background:var(--glass);border:1px solid rgba(255,255,255,0.04);
      color:inherit;font-size:14px;outline:none
    }
    .btn{
      display:inline-flex;align-items:center;gap:8px;padding:10px 12px;
      border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent),#3ee1a6);
      color:#04201a;font-weight:600;cursor:pointer
    }
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent);font-weight:600}

    .preview{
      background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      border-radius:10px;padding:14px;display:flex;flex-direction:column;
      gap:10px;align-items:stretch;height:100%;
    }
    .key-box{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.02);
      padding:12px;border-radius:8px;border:1px dashed rgba(255,255,255,0.03);
      font-family:monospace;font-size:13px;word-break:break-all}
    .meta{display:flex;justify-content:space-between;gap:8px;font-size:13px;color:var(--muted)}
    .small{font-size:12px;color:var(--muted)}
    .actions{display:flex;gap:8px;align-items:center}
    .chip{padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.02);font-size:12px}
    footer{margin-top:16px;display:flex;justify-content:space-between;align-items:center;
      color:var(--muted);font-size:13px}

    @media (max-width:880px){
      form{grid-template-columns:1fr;}
      .preview{order:2}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="region" aria-labelledby="title">
      <div class="header">
        <div>
          <h1 id="title">Generate API Key</h1>
          <p class="lead">Buat dan kelola API key untuk integrasi layanan â€” aman, mudah, dan responsif.</p>
        </div>
        <div class="meta">
          <div class="chip">Akses: Public API</div>
        </div>
      </div>

      <form id="form">
        <div class="controls">
          <div>
            <label for="name">Nama kunci (label)</label>
            <input id="name" class="input" placeholder="mis. integrasi-payment, mobile-app" maxlength="60" />
          </div>

          <div>
            <label for="role">Peran / Scope</label>
            <select id="role" class="select">
              <option value="read">Read-only</option>
              <option value="write">Read & Write</option>
              <option value="admin">Admin (semua akses)</option>
            </select>
          </div>

          <div>
            <label for="expiry">Masa berlaku (opsional)</label>
            <select id="expiry" class="select">
              <option value="0">Tidak kadaluarsa</option>
              <option value="7">7 hari</option>
              <option value="30">30 hari</option>
              <option value="90">90 hari</option>
              <option value="365">1 tahun</option>
            </select>
          </div>

          <div style="display:flex;gap:10px">
            <button id="generate" type="button" class="btn">Generate Key</button>
            <button id="save" type="button" class="btn ghost">Simpan</button>
          </div>

          <div class="small">Catatan: Setelah disimpan, kunci hanya akan ditampilkan sekali. Pastikan menyimpannya di tempat aman.</div>
        </div>

        <aside class="preview" aria-live="polite">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div style="font-weight:700">Preview API Key</div>
              <div class="small">Tampilan kunci yang baru saja di-generate (masking tersedia)</div>
            </div>
            <div class="actions">
              <button id="toggleMask" type="button" class="btn ghost">Tampilkan</button>
            </div>
          </div>

          <div class="key-box" id="keyBox">â€” belum ada kunci â€”</div>

          <div class="meta">
            <div id="keyInfo">Tidak ada</div>
            <div style="display:flex;gap:8px">
              <button id="copy" type="button" class="btn ghost">Copy</button>
              <button id="regen" type="button" class="btn ghost">Regenerate</button>
            </div>
          </div>

          <div style="margin-top:auto">
            <label for="notes">Catatan / Deskripsi (opsional)</label>
            <textarea id="notes" rows="3" class="textarea" placeholder="Contoh: untuk integrasi mobile app versi 2"></textarea>
          </div>
        </aside>
      </form>

      <footer>
        <div>ðŸ”’ Keamanan: kunci dibuat melalui backend (Node.js + crypto).</div>
        <div>Versi UI â€¢ 2.0 (Server Generated)</div>
      </footer>
    </div>
  </div>

  <!-- ===== Script yang panggil /create backend ===== -->
  <script>
    const keyBox = document.getElementById('keyBox');
    const keyInfo = document.getElementById('keyInfo');
    const generateBtn = document.getElementById('generate');
    const copyBtn = document.getElementById('copy');
    const saveBtn = document.getElementById('save');
    const regenBtn = document.getElementById('regen');
    const toggleMask = document.getElementById('toggleMask');

    let currentKey = '';
    let masked = true;

    function maskKey(k){
      if(!k) return 'â€” belum ada kunci â€”';
      const parts = k.split('-');
      return parts.map((p,i)=> i===parts.length-1 ? '****'+p.slice(-4) : 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢').join('-');
    }

    function updateUI(){
      keyBox.textContent = masked ? maskKey(currentKey) : (currentKey || 'â€” belum ada kunci â€”');
      keyInfo.textContent = currentKey ? ('Pan. ' + currentKey.length + ' chars') : 'Tidak ada';
      toggleMask.textContent = masked ? 'Tampilkan' : 'Sembunyikan';
    }

    async function createKeyFromServer() {
      generateBtn.disabled = true;
      generateBtn.textContent = 'Generating...';

      try {
        const res = await fetch('/create', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ length: 24 })
        });
        const data = await res.json();

        if (!data.apiKey) throw new Error('Gagal menerima API key dari server');
        let received = data.apiKey;
        if (!received.includes('-')) received = received.match(/.{1,8}/g).join('-');

        currentKey = received;
        masked = true;
        updateUI();
      } catch (err) {
        alert('Terjadi kesalahan: ' + err.message);
      } finally {
        generateBtn.disabled = false;
        generateBtn.textContent = 'Generate Key';
      }
    }

    async function copyKey() {
      if(!currentKey) return alert('Belum ada kunci untuk disalin.');
      await navigator.clipboard.writeText(currentKey);
      copyBtn.textContent = 'Tersalin!';
      setTimeout(()=>copyBtn.textContent='Copy',1200);
    }

    // Event handler
    generateBtn.addEventListener('click', createKeyFromServer);
    regenBtn.addEventListener('click', createKeyFromServer);
    toggleMask.addEventListener('click', ()=> { masked = !masked; updateUI(); });
    copyBtn.addEventListener('click', copyKey);

    saveBtn.addEventListener('click', ()=>{
      if(!currentKey){ alert('Silakan generate kunci terlebih dahulu.'); return }
      alert('Kunci ini seharusnya dikirim ke server untuk disimpan (fitur save-key opsional).');
    });

    updateUI();
  </script>
</body>
</html>
